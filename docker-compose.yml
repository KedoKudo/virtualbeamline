# Docker composor for the default virtual 6IDD testing ENV
version: '3.7'

services:
  caRepeat:
    container_name: caRepeater
    image: kedokudo/virtualbeamline:epics-base
    networks:
      - host
    entrypoint:
      - bin/linux-x86_64/caRepeater
  
  ioc6iddsimmtr:
    container_name: ioc6iddsimmtr
    image: kedokudo/virtualbeamline:ioc6iddsimmtr
    stdin_open: true
    tty: true
    networks:
      - host
    environment:
      - IOC_PREFIX='6iddSIM:'
      - IOCNAME='6iddSIM'
    expose:
      - "5064" 
      - "5065"
    depends_on:
      - caRepeat
  
  ioc6iddsimdet:
    container_name: ioc6iddsimdet
    image: kedokudo/virtualbeamline:ioc6iddsimdet
    stdin_open: true
    tty: true
    networks:
      - host
    environment:
      - IOC_PREFIX='6iddSIMDET1:'
    expose:
      - "5064" 
      - "5065"
    depends_on:
      - caRepeat
  
  console:
    container_name: console
    image: kedokudo/virtualbeamline:epics-base
    stdin_open: true
    tty: true
    entrypoint:
      - /bin/bash
    networks:
      - host
    depends_on:
      - caRepeat
      - ioc6iddsimdet
      - ioc6iddsimmtr
  
  detUI:
    container_name: detectorUI
    image: kedokudo/virtualbeamline:caQTDM
    stdin_open: true
    tty: true
    entrypoint:
      - /bin/bash
    networks:
      - host
    environment:
      - DISPLAY="130.202.62.166:0"
    volumes:
      - "$HOME/.Xauthority:/root/.Xauthority:rw"
    depends_on:
      - caRepeat
      - ioc6iddsimdet
  
  mongo:
    container_name: mongoDB
    image: mongo
    ports:
      - "27017:27017"

  frontend:
    container_name: jupyterlab
    image: kedokudo/virtualbeamline:jupyter
    stdin_open: true
    tty: true
    networks:
      - host
    ports:
      - "8899:8888"
    entrypoint:
      - "jupyter"
      - "lab"
      - "--ip=0.0.0.0"
      - "--no-browser"
      - "--allow-root"

networks:
  host:
